{
  "inode": {
    "org": "",
    "id": "cmdb_workflow-2djixgq75rcmf",
    "schema_id": "cmdb_schema_workflow-0",
    "name": "[AutoGen] 运维工单（测试）Executor 工作流",
    "namespace": "",
    "descr": "",
    "ctime": 0,
    "mtime": 0,
    "creator": "",
    "last_editor": "",
    "archived": false,
    "lock": ""
  },
  "data": {
    "persist_level": "job_unit",
    "persist_retention": 3600,
    "nodes": [
      {
        "component": "cmdb_component-vars",
        "descr": "起始节点",
        "config": {
          "schema": {
            "type": "object",
            "properties": {
              "ticket_instance_name": {
                "type": "string",
                "title": "工单实例名称"
              },
              "ticket_instance_id": {
                "type": "string",
                "title": "工单实例 ID"
              },
              "ticket_template": {
                "type": "object",
                "properties": {
                  "ticket_name": {
                    "type": "string"
                  },
                  "ticket_descr": {
                    "type": "string"
                  },
                  "ticket_type": {
                    "type": "string"
                  },
                  "steps": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "component_id": {
                          "type": "string"
                        },
                        "config": {
                          "type": "object"
                        },
                        "input": {
                          "type": "object"
                        },
                        "fail_policy": {
                          "type": "string"
                        },
                        "set_vars": {
                          "type": "array",
                          "items": {
                            "type": "object"
                          }
                        },
                        "premise": {
                          "type": "array",
                          "items": {
                            "type": "object"
                          }
                        }
                      }
                    }
                  },
                  "input_schema": {
                    "type": "string"
                  },
                  "vars_schema": {
                    "type": "string"
                  }
                }
              },
              "ticket_input": {
                "type": "object",
                "properties": {
                  "[auto]4d5d0_input": {
                    "type": "object",
                    "properties": {},
                    "required": [],
                    "title": "输入"
                  }
                },
                "title": "工单发起参数"
              },
              "step_instances": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        },
        "inputs": {
          "*": {}
        },
        "auto_run": true,
        "name": "__START__"
      },
      {
        "component": "cmdb_component-vars",
        "name": "__END__",
        "auto_run": true,
        "descr": "返回节点",
        "config": {}
      },
      {
        "name": "Prepare",
        "auto_run": true,
        "inputs": {
          "__START__": "{var:__START__.output}"
        },
        "component": "cmdb_component-interpreter_ecmascript",
        "config": {
          "script": "resources/scripts/cmdb_workflow-2djixgq75rcmf.data.nodes.2.config.script.js",
          "timeout_s": 30,
          "input_schema": "{\"type\":\"object\",\"properties\":{\"ticket_instance_name\":{\"type\":\"string\",\"title\":\"工单实例名称\"},\"ticket_instance_id\":{\"type\":\"string\",\"title\":\"工单实例 ID\"},\"ticket_template\":{\"type\":\"object\",\"properties\":{\"ticket_name\":{\"type\":\"string\"},\"ticket_descr\":{\"type\":\"string\"},\"ticket_type\":{\"type\":\"string\"},\"steps\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"component_id\":{\"type\":\"string\"},\"config\":{\"type\":\"object\"},\"input\":{\"type\":\"object\"},\"fail_policy\":{\"type\":\"string\"},\"set_vars\":{\"type\":\"array\",\"items\":{\"type\":\"object\"}},\"premise\":{\"type\":\"array\",\"items\":{\"type\":\"object\"}}}}},\"input_schema\":{\"type\":\"string\"},\"vars_schema\":{\"type\":\"string\"}}},\"ticket_input\":{\"type\":\"object\",\"properties\":{\"[auto]4d5d0_input\":{\"type\":\"object\",\"properties\":{},\"required\":[],\"title\":\"输入\"}},\"title\":\"工单发起参数\"},\"step_instances\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}}}}",
          "output_schema": "{\"type\":\"object\",\"properties\":{\"result\":{\"type\":\"string\"},\"result_name\":{\"type\":\"string\"},\"message\":{\"type\":\"string\"},\"ticket_info\":{\"type\":\"object\",\"properties\":{\"global_vars\":{\"type\":\"object\"}}}}}"
        },
        "descr": "执行前准备"
      },
      {
        "name": "PrepareOK",
        "descr": "执行准备成功",
        "auto_run": true,
        "component": "cmdb_component-condition",
        "config": {
          "op": "字符串-相等"
        },
        "inputs": {
          "Prepare": {
            "target": "SUCCEEDED",
            "value": "{var:Prepare.output.result}"
          }
        }
      },
      {
        "name": "PrepareFailed",
        "descr": "执行准备失败",
        "auto_run": true,
        "component": "cmdb_component-condition",
        "config": {
          "op": "字符串-不相等"
        },
        "inputs": {
          "Prepare": {
            "target": "SUCCEEDED",
            "value": "{var:Prepare.output.result}"
          }
        }
      },
      {
        "component": "cmdb_component-job_quiter",
        "inputs": {},
        "config": {},
        "name": "AbortFlow",
        "auto_run": true,
        "descr": "终止流转"
      },
      {
        "auto_run": true,
        "name": "ExecStep1",
        "component": "cmdb_component-workflow",
        "descr": "自定义表单",
        "inputs": {
          "PrepareOK": {
            "context": {
              "ticket_id": "{var:__START__.output.ticket_instance_id}",
              "global_vars": "{var:Prepare.output.ticket_info.global_vars}",
              "ticket_input": "{var:__START__.output.ticket_input}",
              "instance_id": "{var:__START__.output.step_instances.#0}",
              "ticket_name": "{var:__START__.output.ticket_instance_name}"
            },
            "step_config": "{var:__START__.output.ticket_template.steps.#0}"
          }
        },
        "config": {
          "id": "cmdb_workflow-170unonfjtq6b"
        }
      }
    ],
    "edges": [
      {
        "from": "__START__",
        "to": "Prepare"
      },
      {
        "from": "Prepare",
        "to": "PrepareOK"
      },
      {
        "from": "Prepare",
        "to": "PrepareFailed"
      },
      {
        "from": "PrepareFailed",
        "to": "AbortFlow"
      },
      {
        "from": "PrepareOK",
        "to": "ExecStep1"
      }
    ]
  },
  "indexes": {}
}